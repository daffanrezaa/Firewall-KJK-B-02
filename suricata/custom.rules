# ========================================================
# SURICATA CUSTOM RULES - FIREWALL PROJECT KJK
# ========================================================

# --------------------------------------------------------
# 1. DETEKSI ICMP FLOOD (Ping of Death / Flood)
# --------------------------------------------------------
alert icmp any any -> any any (msg:"âš ï¸  WARNING: Possible ICMP Flood Detected"; threshold: type both, track by_src, count 20, seconds 1; classtype:attempted-dos; sid:1000001; rev:1;)

# --------------------------------------------------------
# 2. DETEKSI PORT SCANNING (General)
# --------------------------------------------------------
alert tcp any any -> any any (msg:"âš ï¸  WARNING: Nmap TCP Scan Detected"; flags:S; threshold: type both, track by_src, count 30, seconds 10; classtype:attempted-recon; sid:1000002; rev:1;)

# --------------------------------------------------------
# 3. DETEKSI SSH BRUTE FORCE (General)
# --------------------------------------------------------
alert tcp any any -> any 22 (msg:"ðŸš¨ CRITICAL: Potential SSH Brute Force Attack"; flags:S; threshold: type both, track by_src, count 5, seconds 30; classtype:attempted-user; sid:1000003; rev:1;)

# --------------------------------------------------------
# 4. DETEKSI DATABASE ATTACK (MySQL)
# --------------------------------------------------------
alert tcp !10.20.20.0/24 any -> any 3306 (msg:"âš ï¸  WARNING: Unauthorized Access to MySQL Database"; flags:S; classtype:policy-violation; sid:1000004; rev:1;)

# --------------------------------------------------------
# 5. DETEKSI AKSES DARI GUEST (Zone 10.20.50.x)
# --------------------------------------------------------
alert ip 10.20.50.0/24 any -> 10.20.40.0/24 any (msg:"ðŸš¨ CRITICAL: Guest Zone attempting access to Admin Zone"; classtype:policy-violation; sid:1000005; rev:1;)
alert ip 10.20.50.0/24 any -> 10.20.20.0/24 any (msg:"ðŸš¨ CRITICAL: Guest Zone attempting access to Akademik Zone"; classtype:policy-violation; sid:1000006; rev:1;)

# ========================================================
# NEW RULES: CASE DATA LEAKAGE (MAHASISWA -> RISET)
# ========================================================

# --------------------------------------------------------
# A. DETEKSI SYN SCAN DARI MAHASISWA (KE RISET & AKADEMIK)
# --------------------------------------------------------
# Logika: Mendeteksi >20 paket SYN dalam 10 detik dari subnet Mahasiswa.
# Rule 1: Mahasiswa -> Riset
alert tcp 10.20.10.0/24 any -> 10.20.30.0/24 any (msg:"âš ï¸  WARNING: SYN Scan from Mahasiswa to Riset Network"; flags:S; threshold: type both, track by_src, count 20, seconds 10; classtype:attempted-recon; sid:2000001; rev:2;)
# Rule 2: Mahasiswa -> Akademik
alert tcp 10.20.10.0/24 any -> 10.20.20.0/24 any (msg:"âš ï¸  WARNING: SYN Scan from Mahasiswa to Akademik Network"; flags:S; threshold: type both, track by_src, count 20, seconds 10; classtype:attempted-recon; sid:2000004; rev:1;)

# --------------------------------------------------------
# B. DETEKSI SSH BRUTE FORCE KE SERVER RISET
# --------------------------------------------------------
# Logika: Mendeteksi >3 percobaan koneksi SSH (SYN) ke Server Riset (10.20.30.10) dalam 30 detik.
# Indikasi upaya login paksa.
alert tcp 10.20.10.0/24 any -> 10.20.30.10 22 (msg:"ðŸš¨ CRITICAL: SSH Brute Force Attempt from Mahasiswa to Riset Server"; flags:S; threshold: type both, track by_src, count 3, seconds 30; classtype:attempted-user; sid:2000002; rev:1;)

# --------------------------------------------------------
# C. DETEKSI DATA EXFILTRATION (HTTP) DARI SERVER RISET
# --------------------------------------------------------
# Logika: Mendeteksi respon HTTP 200 OK dari Server Riset ke Mahasiswa yang mengindikasikan transfer file sukses.
# Filter konten biner atau file terenkripsi sulit tanpa SSL decryption, jadi kita monitor flow HTTP sukses.
alert http 10.20.30.10 any -> 10.20.10.0/24 any (msg:"ðŸš¨ CRITICAL: Suspicious File Transfer / Data Exfiltration from Riset Server"; flow:established,from_server; http.response_code; content:"200"; classtype:policy-violation; sid:2000003; rev:1;)